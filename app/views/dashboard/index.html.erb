<div class="mx-auto max-w-6xl px-4 py-8">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
    <div class="min-w-0">
      <h1 class="truncate text-2xl font-semibold text-gray-900">Upcoming Service Events</h1>
      <p class="mt-1 text-sm text-gray-600">
        Next 7 days • <%= pluralize(@service_events.size, "event") %>
      </p>
    </div>
  </div>

  <div class="mt-6 grid gap-4 md:grid-cols-3">
    <div class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-gray-200">
      <p class="text-sm font-medium text-gray-600">Order revenue (YTD)</p>
      <p class="mt-2 text-2xl font-semibold text-gray-900">
        <%= number_to_currency(@ytd_order_total_cents.to_i / 100.0) %>
      </p>
      <p class="mt-1 text-xs text-gray-500">Start of year → <%= l(Date.current) %></p>
    </div>
  </div>

  <div class="mt-6 overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-gray-200">
    <div class="border-b border-gray-200 px-4 py-3">
      <h2 class="text-base font-semibold text-gray-900">Inventory overview</h2>
      <p class="text-sm text-gray-600">Track total assets, availability, and monthly rentals by unit type.</p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Unit type</th>
            <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Total units</th>
            <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Available</th>
            <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Rented</th>
            <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Monthly rentals</th>
            <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Event rentals</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white">
          <% if @inventory_stats.any? %>
            <% @inventory_stats.each do |row| %>
              <tr>
                <td class="px-4 py-3 text-sm font-medium text-gray-900">
                  <%= row[:unit_type].name %>
                </td>
                <td class="px-4 py-3 text-right text-sm text-gray-900"><%= row[:total_units] %></td>
                <td class="px-4 py-3 text-right text-sm text-emerald-700">
                  <%= row[:available_units] %>
                </td>
                <td class="px-4 py-3 text-right text-sm text-rose-700">
                  <%= row[:rented_units] %>
                </td>
                <td class="px-4 py-3 text-right text-sm text-blue-700">
                  <%= row[:monthly_out] %>
                </td>
                <td class="px-4 py-3 text-right text-sm text-indigo-700">
                  <%= row[:event_out] %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="5" class="px-4 py-6 text-center text-sm text-gray-500">
                No unit types defined yet.
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-6 overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-gray-200">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Date</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Event</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Order</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Customer</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Location</th>
          <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100 bg-white">
        <% if @service_events.any? %>
          <% @service_events.each do |event| %>
            <% order = event.order %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3 whitespace-nowrap">
                <div class="text-sm font-semibold text-gray-900"><%= l(event.scheduled_on, format: :long) %></div>
              </td>

              <td class="px-4 py-3">
                <span class="inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-xs font-medium text-blue-700">
                  <%= event.event_type.humanize %>
                </span>
              </td>

              <td class="px-4 py-3">
                <div class="text-sm font-semibold text-gray-900">
                  <%= link_to(order.external_reference.presence || "##{order.id}", order_path(order), class: "hover:underline") %>
                </div>
                <div class="mt-1 text-xs text-gray-600">
                  <%= l(order.start_date) %> <span class="text-gray-400">→</span> <%= l(order.end_date) %>
                </div>
              </td>

              <td class="px-4 py-3">
                <div class="text-sm font-medium text-gray-900"><%= order.customer.display_name %></div>
                <div class="mt-1 text-xs text-gray-600"><%= order.customer.billing_email %></div>
              </td>

              <td class="px-4 py-3">
                <div class="text-sm font-medium text-gray-900"><%= order.location.label %></div>
                <div class="mt-1 text-xs text-gray-600">
                  <%= [order.location.city, order.location.state].compact.join(", ") %>
                </div>
              </td>

              <td class="px-4 py-3 text-right">
                <% if event.report_required? %>
                  <%= link_to "Complete",
                    new_service_event_report_path(service_event_id: event.id),
                    class: "inline-flex items-center rounded-lg bg-green-600 px-3 py-2 text-xs font-semibold text-white hover:bg-green-500" %>
                <% else %>
                  <%= button_to "Complete",
                    service_event_path(event),
                    method: :patch,
                    params: { service_event: { status: :completed } },
                    class: "inline-flex items-center rounded-lg bg-green-600 px-3 py-2 text-xs font-semibold text-white hover:bg-green-500",
                    data: { turbo_confirm: "Mark this event as completed?" } %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="6" class="px-4 py-10 text-center text-sm text-gray-500">
              No service events scheduled for the upcoming week.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
