<%= page_shell do %>
  <h1 class="text-2xl font-semibold text-gray-900">Tell us about your company</h1>
  <p class="mt-1 text-sm text-gray-600">Provide the basics so Honeywagon can personalize your dashboard.</p>

  <%= form_with model: @company, url: setup_company_path, method: :put, local: true do |f| %>
    <%= card classes: "mt-4 space-y-4" do %>
      <div>
        <%= f.label :name, "Company name", class: "text-sm font-medium text-gray-700" %>
        <%= f.text_field :name, class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-gray-900 focus:ring-2 focus:ring-gray-900/20" %>
      </div>

      <div>
        <h2 class="text-lg font-semibold text-gray-900">Unit types</h2>
        <p class="text-sm text-gray-600">Define the equipment you operate.</p>
        <div data-controller="unit-types">
          <div data-unit-types-target="list" class="mt-3 space-y-3">
            <% @unit_types.each_with_index do |unit_type, index| %>
              <div class="grid gap-3 rounded-xl border border-gray-200 p-3 md:grid-cols-3">
                <div>
                  <label class="text-xs font-medium text-gray-600">Name</label>
                  <%= text_field_tag "setup[unit_types][#{index}][name]", unit_type[:name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Slug</label>
                  <%= text_field_tag "setup[unit_types][#{index}][slug]", unit_type[:slug], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Prefix</label>
                  <%= text_field_tag "setup[unit_types][#{index}][prefix]", unit_type[:prefix], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
              </div>
            <% end %>
          </div>
          <button type="button" data-action="unit-types#add" class="<%= button_classes(variant: :outline, size: :sm) %> mt-3">Add unit type</button>
        </div>
      </div>

      <div>
        <h2 class="text-lg font-semibold text-gray-900">Available inventory</h2>
        <p class="text-sm text-gray-600">How many units of each type do you currently have?</p>
        <div class="mt-3 grid gap-4 md:grid-cols-2">
          <% current_user.company.unit_types.each do |unit_type| %>
            <div class="rounded-xl border border-gray-200 p-3">
              <label class="text-sm font-medium text-gray-700"><%= unit_type.name %></label>
              <%= hidden_field_tag "setup[units][][unit_type_slug]", unit_type.slug %>
              <%= number_field_tag "setup[units][][quantity]", 0, min: 0, class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
            </div>
          <% end %>
        </div>
      </div>

      <div>
        <h2 class="text-lg font-semibold text-gray-900">Customers</h2>
        <p class="text-sm text-gray-600">Add any customers you already work with.</p>
        <div id="customers" data-controller="customers">
          <div data-customers-target="list" class="space-y-3">
            <% @customers.each_with_index do |customer, index| %>
              <div class="rounded-xl border border-gray-200 p-3">
                <div class="grid gap-3 md:grid-cols-2">
                  <div>
                    <label class="text-xs font-medium text-gray-600">Company name</label>
                    <%= text_field_tag "setup[customers][#{index}][company_name]", customer[:company_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Billing email</label>
                    <%= email_field_tag "setup[customers][#{index}][billing_email]", customer[:billing_email], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">First name</label>
                    <%= text_field_tag "setup[customers][#{index}][first_name]", customer[:first_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Last name</label>
                    <%= text_field_tag "setup[customers][#{index}][last_name]", customer[:last_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Phone</label>
                    <%= telephone_field_tag "setup[customers][#{index}][phone]", customer[:phone], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <button type="button" data-action="customers#add" class="<%= button_classes(variant: :outline, size: :sm) %> mt-3">Add customer</button>
        </div>
      </div>

      <div>
        <%= f.submit "Complete setup", class: button_classes(variant: :primary) %>
      </div>
    <% end %>
  <% end %>
<% end %>
