<%= page_shell do %>
  <h1 class="text-2xl font-semibold text-gray-900">Tell us about your company</h1>
  <p class="mt-1 text-sm text-gray-600">Provide the basics so Dumpr can personalize your dashboard.</p>

  <%= form_with model: @company, url: setup_company_path, method: :put, local: true do |f| %>
    <%= card classes: "mt-4 space-y-4" do %>
      <div>
        <%= f.label :name, "Company name", class: "text-sm font-medium text-gray-700" %>
        <%= f.text_field :name, class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-gray-900 focus:ring-2 focus:ring-gray-900/20" %>
      </div>

      <div>
        <h2 class="text-lg font-semibold text-gray-900">Inventory</h2>
        <p class="text-sm text-gray-600">Define your unit types and how many of each you operate.</p>
        <div data-controller="unit-types">
          <div data-unit-types-target="list" class="mt-3 space-y-3">
            <% @unit_types.each_with_index do |unit_type, index| %>
              <div class="grid gap-3 rounded-xl border border-gray-200 p-3 md:grid-cols-4" data-unit-type-entry>
                <div>
                  <label class="text-xs font-medium text-gray-600">Name</label>
                  <%= text_field_tag "setup[unit_types][#{index}][name]", unit_type[:name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Slug</label>
                  <%= text_field_tag "setup[unit_types][#{index}][slug]", unit_type[:slug], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Prefix</label>
                  <%= text_field_tag "setup[unit_types][#{index}][prefix]", unit_type[:prefix], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Quantity</label>
                  <%= number_field_tag "setup[unit_types][#{index}][quantity]", unit_type[:quantity] || 0, min: 0, class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                </div>
              </div>
            <% end %>
          </div>
          <template data-unit-types-target="template">
            <div class="grid gap-3 rounded-xl border border-gray-200 p-3 md:grid-cols-4" data-unit-type-entry>
              <div>
                <label class="text-xs font-medium text-gray-600">Name</label>
                <input type="text" name="setup[unit_types][__INDEX__][name]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
              </div>
              <div>
                <label class="text-xs font-medium text-gray-600">Slug</label>
                <input type="text" name="setup[unit_types][__INDEX__][slug]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
              </div>
              <div>
                <label class="text-xs font-medium text-gray-600">Prefix</label>
                <input type="text" name="setup[unit_types][__INDEX__][prefix]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
              </div>
              <div>
                <label class="text-xs font-medium text-gray-600">Quantity</label>
                <input type="number" min="0" name="setup[unit_types][__INDEX__][quantity]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
              </div>
            </div>
          </template>
          <button type="button" data-action="unit-types#add" class="<%= button_classes(variant: :outline, size: :sm) %> mt-3">Add unit type</button>
        </div>
      </div>

      <div>
        <h2 class="text-lg font-semibold text-gray-900">Customers</h2>
        <p class="text-sm text-gray-600">Add any customers you already work with.</p>
        <div data-controller="customers">
          <div data-customers-target="list" class="space-y-3">
            <% @customers.each_with_index do |customer, index| %>
              <div class="rounded-xl border border-gray-200 p-3" data-customer-entry>
                <div class="grid gap-3 md:grid-cols-2">
                  <div>
                    <label class="text-xs font-medium text-gray-600">Company name</label>
                    <%= text_field_tag "setup[customers][#{index}][business_name]", customer[:business_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Billing email</label>
                    <%= email_field_tag "setup[customers][#{index}][billing_email]", customer[:billing_email], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">First name</label>
                    <%= text_field_tag "setup[customers][#{index}][first_name]", customer[:first_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Last name</label>
                    <%= text_field_tag "setup[customers][#{index}][last_name]", customer[:last_name], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                  <div>
                    <label class="text-xs font-medium text-gray-600">Phone</label>
                    <%= telephone_field_tag "setup[customers][#{index}][phone]", customer[:phone], class: "mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <template data-customers-target="template">
            <div class="rounded-xl border border-gray-200 p-3" data-customer-entry>
              <div class="grid gap-3 md:grid-cols-2">
                <div>
                  <label class="text-xs font-medium text-gray-600">Company name</label>
                  <input type="text" name="setup[customers][__INDEX__][business_name]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Billing email</label>
                  <input type="email" name="setup[customers][__INDEX__][billing_email]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">First name</label>
                  <input type="text" name="setup[customers][__INDEX__][first_name]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Last name</label>
                  <input type="text" name="setup[customers][__INDEX__][last_name]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
                </div>
                <div>
                  <label class="text-xs font-medium text-gray-600">Phone</label>
                  <input type="tel" name="setup[customers][__INDEX__][phone]" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" />
                </div>
              </div>
            </div>
          </template>
          <button type="button" data-action="customers#add" class="<%= button_classes(variant: :outline, size: :sm) %> mt-3">Add customer</button>
        </div>
      </div>

      <div>
        <%= f.submit "Complete setup", class: button_classes(variant: :primary) %>
      </div>
    <% end %>
  <% end %>
<% end %>
