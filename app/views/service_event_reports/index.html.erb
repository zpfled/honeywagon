<div class="mx-auto max-w-6xl px-4 py-8">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
    <div class="min-w-0">
      <h1 class="truncate text-2xl font-semibold text-gray-900">Service Log</h1>
      <p class="mt-1 text-sm text-gray-600">
        <%= @month.strftime("%B %Y") %> · <%= pluralize(@reports.size, "report") %>
      </p>
      <div class="mt-2 flex flex-wrap items-center gap-2 text-sm text-gray-600">
        <span class="inline-flex items-center gap-1 rounded-full bg-blue-50 px-2.5 py-1 text-xs font-semibold text-blue-900">
          Pumped <%= number_with_delimiter(@monthly_pumped_gallons) %> gal
        </span>
        <span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2.5 py-1 text-xs font-semibold text-amber-900">
          Dumped <%= number_with_delimiter(@monthly_dumped_gallons) %> gal
        </span>
      </div>
    </div>
    <div class="inline-flex rounded-full bg-white ring-1 ring-gray-200 shadow-sm">
      <%= link_to "← #{@previous_month.strftime('%b %Y')}",
                  service_event_reports_path(month: @previous_month.strftime('%Y-%m')),
                  class: "inline-flex items-center rounded-l-full px-3 py-1.5 text-xs font-semibold text-gray-700 hover:bg-gray-50" %>
      <%= link_to "#{@next_month.strftime('%b %Y')} →",
                  service_event_reports_path(month: @next_month.strftime('%Y-%m')),
                  class: "inline-flex items-center rounded-r-full border-l border-gray-200 px-3 py-1.5 text-xs font-semibold text-gray-700 hover:bg-gray-50" %>
    </div>
  </div>

  <%# TODO: Use ServiceEventReportPresenter + FormattingHelper; paginate results to handle large logs %>
  <div class="mt-6 overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-gray-200">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Date</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Customer</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Address</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Units Serviced</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-600">Estimated Gallons</th>
          <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-600">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100 bg-white">
        <% if @report_presenters&.any? %>
          <% @report_presenters.each do |presenter| %>
            <% report = presenter.report %>
            <tr class="<%= presenter.row_classes %>">
              <td class="px-4 py-3 text-sm text-gray-900">
                <div class="font-semibold"><%= presenter.date_label %></div>
                <div class="text-xs text-gray-500"><%= presenter.time_label %></div>
                <% if presenter.event_type_label.present? %>
                  <span class="mt-1 inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold <%= presenter.badge_classes %>">
                    <%= presenter.event_type_label %>
                  </span>
                <% end %>
              </td>

              <td class="px-4 py-3 text-sm text-gray-900">
                <div class="font-semibold"><%= presenter.customer_name %></div>
              </td>

              <td class="px-4 py-3 text-sm text-gray-900">
                <%= presenter.address_label %>
              </td>

              <td class="px-4 py-3 text-sm text-gray-900">
                <%= presenter.units_serviced_label %>
              </td>

              <td class="px-4 py-3 text-sm text-gray-900">
                <%= presenter.estimated_gallons_label %>
              </td>
              <td class="px-4 py-3 text-right">
                <%= link_to "Edit", edit_service_event_report_path(report, redirect_path: service_event_reports_path),
                            class: "inline-flex items-center rounded-full border border-gray-200 px-3 py-1 text-xs font-semibold text-gray-700 hover:bg-gray-50",
                            data: { turbo_frame: "service_event_modal" } %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="6" class="px-4 py-10 text-center text-sm text-gray-500">
              No service reports yet.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
