<% modal = local_assigns.fetch(:modal, false) %>
<% redirect_path = local_assigns[:redirect_path] %>
<% form_model = @report || ServiceEventReport.new %>
<% form_url = local_assigns[:form_url] || (form_model.persisted? ? service_event_report_path(form_model) : service_event_reports_path) %>
<% form_method = local_assigns[:form_method] || (form_model.persisted? ? :patch : :post) %>
<% form_options = { model: form_model, url: form_url, method: form_method } %>
<% form_options[:data] = { turbo_frame: "_top" } if modal %>

<%= form_with(**form_options) do |f| %>
  <% if @service_event %>
    <%= hidden_field_tag :service_event_id, @service_event.id %>
  <% end %>
  <%= hidden_field_tag :redirect_path, redirect_path if redirect_path.present? %>

  <div class="space-y-6">
    <% if @service_event&.event_type_dump? %>
      <div>
        <%= f.label :estimated_gallons_dumped, "Estimated gallons dumped", class: "text-sm font-medium text-gray-700" %>
        <%= f.number_field :estimated_gallons_dumped,
          value: @report&.data&.dig("estimated_gallons_dumped"),
          step: 1,
          min: 0,
          autofocus: true,
          class: "mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-gray-900 focus:ring-2 focus:ring-gray-900/20" %>
      </div>
    <% else %>
      <div>
        <%= f.label :estimated_gallons_pumped, "Estimated gallons pumped", class: "text-sm font-medium text-gray-700" %>
        <%= f.number_field :estimated_gallons_pumped,
          value: @report&.data&.dig("estimated_gallons_pumped"),
          step: 1,
          min: 0,
          autofocus: true,
          class: "mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-gray-900 focus:ring-2 focus:ring-gray-900/20" %>
      </div>

      <div>
        <%= f.label :units_pumped, "Units serviced", class: "text-sm font-medium text-gray-700" %>
        <%= f.number_field :units_pumped,
          value: @report&.data&.dig("units_pumped") || @prefill[:units_pumped],
          step: 1,
          min: 0,
          class: "mt-1 block w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-gray-900 focus:ring-2 focus:ring-gray-900/20" %>
      </div>
    <% end %>
  </div>

  <div class="mt-6 flex justify-end gap-2">
    <% if modal %>
      <button type="button"
        class="inline-flex items-center rounded-lg bg-white px-3 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
        data-action="click->modal#close">
        Cancel
      </button>
    <% else %>
      <%= link_to "Cancel", authenticated_root_path,
        class: "inline-flex items-center rounded-lg bg-white px-3 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
    <% end %>
    <%= f.submit "Submit report",
      class: "inline-flex items-center rounded-lg bg-gray-900 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-800" %>
  </div>
<% end %>
